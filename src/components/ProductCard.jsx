import { Link, useLocation, useNavigate } from "react-router-dom";
import { IsItemInCart } from "../utils/isItemInCart";
import { useAuth } from "../context/auth-context";
import { useCart } from "../context/cart-context";
import { addItemToCart } from "../services/cartServices";
export const ProductCard = (props) => {
  const { dispatchCart } = useCart();

  const { auth } = useAuth();
  const inCart = IsItemInCart(props.cardDetails.pid);
  const navigate = useNavigate();
  const { pathname } = useLocation();

  return (
    <>
      {/* Card  */}
      <div className="card card-vertical prod-item-1">
        {props.cardDetails.isBestSeller =='0'?null: <span className="card-badge-green">Best Seller</span>}
        {props.cardDetails.isOutofStock =='0' ?null: (
          <div className="card-overlay-container">
            <div className="card-overlay-text">Out of Stock</div>
          </div>
        )}

        

        <div className="card-img-box">
          <Link to={`/product/${props.cardDetails.pid}`}>
            <img src={props.cardDetails.image_url} alt={props.cardDetails.title} className="card-img" />
          </Link>
        </div>
        <div className="card-title">
          <h4>{props.cardDetails.title}</h4>
        </div>
        <p className="card-ratings">
          {props.cardDetails.rating} <i className="material-icons">star</i>
        </p>
        <div className="card-pricing">
          <p className="card-price">₹{props.cardDetails.price}</p>
          <p className="card-price-cut">₹{props.cardDetails.old_price}</p>
          <p className="card-percent-discount">{props.cardDetails.discount}% off</p>
        </div>

        {inCart ? (
          <Link to="/cart" className="btn btn-outline-icon fw-bold">
            <i className="material-icons">shopping_cart</i>
            Go to Cart
          </Link>
        ) : (
          <button
            className="btn btn-solid-icon fw-bold"
            onClick={() => {
              auth.token
                ? addItemToCart({
                    itemDetails: { ...props.cardDetails, quantity: 1 },
                    dispatchCart,
                  })
                : navigate(
                    "/login",
                    { state: { from: { pathname: pathname } } },
                    { replace: true }
                  );
            }}
          >
            <i className="material-icons">shopping_cart</i>
            Add to Cart
          </button>
        )}
      </div>
    </>
  );
};
